<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <title>Gestão de Biblioteca</title>

  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

<body>
  <h1>Gestão de Biblioteca</h1>

  <section id="livros">
    <h2>Lista de Livros</h2>
    <button onclick="listarLivros()">Atualizar Lista</button>
    <ul id="lista-livros">
      <!-- {% for livro in livros %}
      <li><strong>ID:</strong> {{ livro.id }} | <strong>Título:</strong> {{ livro.titulo }} | <strong>Autor:</strong> {{ livro.autor }}</li>
    {% else %}
      <li>Nenhum livro encontrado.</li>
    {% endfor %} -->
    </ul>
  </section>

  <section id="adicionar">
    <h2>Adicionar Livro</h2>
    <input type="text" id="titulo" placeholder="Título">
    <input type="text" id="autor" placeholder="Autor">
    <button onclick="adicionarLivro()">Adicionar</button>
  </section>

  <section id="atualizar">
    <h2>Atualizar Livro</h2>
    <input type="number" id="id-atualizar" placeholder="ID">
    <input type="text" id="titulo-atualizar" placeholder="Novo Título">
    <input type="text" id="autor-atualizar" placeholder="Novo Autor">
    <button onclick="atualizarLivro()">Atualizar</button>
  </section>

  <section id="deletar">
    <h2>Deletar Livro</h2>
    <input type="number" id="id-deletar" placeholder="ID">
    <button onclick="deletarLivro()">Deletar</button>
  </section>

  <section id="buscar">
    <h2>Buscar Livro por ID</h2>
    <input type="number" id="id-buscar" placeholder="ID">
    <button onclick="buscarLivroPorId()">Buscar</button>
    <div id="resultado-busca"></div>
  </section>

  <script>
    const API_URL = 'http://localhost:5000/bibliotecas';
    async function listarLivros() {
      try {
        const response = await fetch(API_URL);
        const livros = await response.json();
        const listaLivros = document.getElementById('lista-livros');
        listaLivros.innerHTML = '';
        if (livros.length === 0) {
          const li = document.createElement('li');
          li.textContent = 'Nenhum livro encontrado.';
          listaLivros.appendChild(li);
        } else {
          livros.forEach(livro => {
            const li = document.createElement('li');
            li.innerHTML = `<strong>ID:</strong> ${livro.id} | <strong>Título:</strong> ${livro.titulo} | <strong>Autor:</strong> ${livro.autor}`;
            listaLivros.appendChild(li);
          });
        }
      } catch (error) {
        console.error('Erro ao buscar livros:', error);
      }
    }

    async function adicionarLivro() {
      const titulo = document.getElementById('titulo').value.trim();
      const autor = document.getElementById('autor').value.trim();

      if (!titulo || !autor) {
        alert('Por favor, preencha título e autor!');
        return;
      }

      const novoLivro = { titulo, autor };

      try {
        const response = await fetch(API_URL, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(novoLivro)
        });

        if (!response.ok) {
          const erro = await response.json();
          alert(erro.erro || 'Erro ao adicionar livro.');
          return;
        }

        alert('Livro adicionado com sucesso!');
        document.getElementById('titulo').value = '';
        document.getElementById('autor').value = '';
        listarLivros();
      } catch (error) {
        console.error('Erro ao adicionar livro:', error);
      }
    }
    async function atualizarLivro() {
      const id = document.getElementById('id-atualizar').value;
      const titulo = document.getElementById('titulo-atualizar').value;
      const autor = document.getElementById('autor-atualizar').value;

      if (!id || !titulo || !autor) {
        alert('Preencha todos os campos.');
        return;
      }

      await fetch(`${API_URL}/${id}`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ titulo, autor })
      });
      alert('Livro enviado com sucesso!');
      // listarLivros();
    }

    async function deletarLivro() {
      const id = document.getElementById('id-deletar').value;
      if (!id) {
        alert('Preencha o ID.');
        return;
      }

      await fetch(`${API_URL}/${id}`, { method: 'DELETE' });

      listarLivros();
    }

    async function buscarLivroPorId() {
      const id = document.getElementById('id-buscar').value;
      if (!id) {
        alert('Preencha o ID.');
        return;
      }

      const resposta = await fetch(`${API_URL}/${id}`);
      const resultado = document.getElementById('resultado-busca');

      if (resposta.ok) {
        const livro = await resposta.json();
        resultado.textContent = `ID: ${livro.id} | Título: ${livro.titulo} | Autor: ${livro.autor}`;
      } else {
        resultado.textContent = 'Livro não encontrado!';
      }
    }

  </script>
  <!-- <script src="{{url_for('static', filename='script.js') }}"></script> -->
</body>

</html>